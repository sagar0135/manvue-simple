<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Commands Debug Test</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #007bff;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .btn:hover {
            background: #0056b3;
        }
        
        .btn.success {
            background: #28a745;
        }
        
        .btn.danger {
            background: #dc3545;
        }
        
        .log {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé§ Voice Commands Debug Test</h1>
        
        <div class="test-section">
            <h3>System Check</h3>
            <button class="btn" onclick="checkSystem()">Check Voice System</button>
            <button class="btn" onclick="checkManVueFunctions()">Check ManVue Functions</button>
            <div id="system-status" class="status">Click buttons to check system status</div>
        </div>
        
        <div class="test-section">
            <h3>Voice Recognition</h3>
            <button id="voice-btn" class="btn" onclick="toggleVoice()">Start Voice Recognition</button>
            <div id="voice-status" class="status">Click to start voice recognition</div>
        </div>
        
        <div class="test-section">
            <h3>Test Commands (Manual)</h3>
            <p>Click these buttons to test voice commands manually:</p>
            <button class="btn success" onclick="testCommand('go home')">Test: Go Home</button>
            <button class="btn success" onclick="testCommand('search for shoes')">Test: Search Shoes</button>
            <button class="btn success" onclick="testCommand('open cart')">Test: Open Cart</button>
            <button class="btn success" onclick="testCommand('add to cart')">Test: Add to Cart</button>
            <button class="btn success" onclick="testCommand('help')">Test: Help</button>
        </div>
        
        <div class="test-section">
            <h3>Debug Log</h3>
            <button class="btn" onclick="clearLog()">Clear Log</button>
            <div id="debug-log" class="log">
                Debug log will appear here...
            </div>
        </div>
    </div>

    <!-- Mock ManVue functions -->
    <script>
        // Mock ManVue functions for testing
        window.searchProducts = function(query) {
            log(`‚úÖ searchProducts called with: "${query}"`);
            return true;
        };
        
        window.addToCart = function(productId) {
            log(`‚úÖ addToCart called with productId: ${productId}`);
            return true;
        };
        
        window.toggleCart = function() {
            log(`‚úÖ toggleCart called`);
            return true;
        };
        
        window.goHome = function() {
            log(`‚úÖ goHome called`);
            return true;
        };
        
        window.showSection = function(section) {
            log(`‚úÖ showSection called with: "${section}"`);
            return true;
        };
        
        window.filterProducts = function(category) {
            log(`‚úÖ filterProducts called with: "${category}"`);
            return true;
        };
        
        window.quickView = function(productId) {
            log(`‚úÖ quickView called with productId: ${productId}`);
            return true;
        };
        
        function log(message) {
            const logDiv = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('debug-log').innerHTML = '';
        }
        
        function updateStatus(message, type = 'success') {
            const statusDiv = document.getElementById('system-status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }
    </script>
    
    <!-- Include voice command scripts -->
    <script src="frontend/voice_ui.js"></script>
    <script src="frontend/voice_interface.js"></script>
    <script src="integration/simple_voice_fix.js"></script>
    
    <script>
        let voiceInterface = null;
        let isListening = false;
        
        function checkSystem() {
            log('üîç Checking voice system...');
            
            const checks = [
                { name: 'Speech Recognition', test: () => 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window },
                { name: 'VoiceInterface', test: () => typeof window.VoiceInterface !== 'undefined' },
                { name: 'SimpleVoiceFix', test: () => typeof window.SimpleVoiceFix !== 'undefined' },
                { name: 'Action Handlers', test: () => window.SimpleVoiceFix && window.SimpleVoiceFix.actionHandlers.size > 0 }
            ];
            
            let allPassed = true;
            checks.forEach(check => {
                const passed = check.test();
                log(`${passed ? '‚úÖ' : '‚ùå'} ${check.name}: ${passed ? 'Available' : 'Not Available'}`);
                if (!passed) allPassed = false;
            });
            
            updateStatus(allPassed ? 'All systems ready!' : 'Some systems missing', allPassed ? 'success' : 'error');
        }
        
        function checkManVueFunctions() {
            log('üîç Checking ManVue functions...');
            
            const functions = ['searchProducts', 'addToCart', 'toggleCart', 'goHome', 'showSection', 'filterProducts'];
            let allAvailable = true;
            
            functions.forEach(func => {
                const available = typeof window[func] === 'function';
                log(`${available ? '‚úÖ' : '‚ùå'} ${func}: ${available ? 'Available' : 'Not Available'}`);
                if (!available) allAvailable = false;
            });
            
            updateStatus(allAvailable ? 'All ManVue functions available!' : 'Some ManVue functions missing', allAvailable ? 'success' : 'error');
        }
        
        function initializeVoice() {
            if (typeof VoiceInterface === 'undefined') {
                log('‚ùå VoiceInterface not available');
                return false;
            }
            
            try {
                voiceInterface = new VoiceInterface({
                    continuous: true,
                    interimResults: true,
                    onResult: handleVoiceResult,
                    onError: handleVoiceError,
                    onStart: handleVoiceStart,
                    onEnd: handleVoiceEnd
                });
                
                log('‚úÖ Voice interface initialized');
                return true;
            } catch (error) {
                log(`‚ùå Failed to initialize voice: ${error.message}`);
                return false;
            }
        }
        
        function toggleVoice() {
            if (!voiceInterface) {
                if (!initializeVoice()) {
                    return;
                }
            }
            
            if (isListening) {
                voiceInterface.stopListening();
            } else {
                voiceInterface.startListening();
            }
        }
        
        function testCommand(command) {
            log(`üß™ Testing command: "${command}"`);
            
            if (!voiceInterface) {
                initializeVoice();
                setTimeout(() => testCommand(command), 500);
                return;
            }
            
            try {
                const result = voiceInterface.commandProcessor.processCommand(command, 0.9);
                
                if (result) {
                    log(`‚úÖ Command processed: ${JSON.stringify(result)}`);
                    
                    if (voiceInterface.executeCommand) {
                        voiceInterface.executeCommand(result);
                    }
                } else {
                    log(`‚ùå Command not recognized: "${command}"`);
                }
                
            } catch (error) {
                log(`‚ùå Error testing command: ${error.message}`);
            }
        }
        
        function handleVoiceResult(transcript, confidence, commandResult) {
            log(`üé§ Voice result: "${transcript}" (${Math.round(confidence * 100)}%)`);
            
            if (commandResult) {
                log(`‚úÖ Command recognized: ${commandResult.action}`);
            } else {
                log(`‚ùå No command matched`);
            }
        }
        
        function handleVoiceError(error, message) {
            log(`üî¥ Voice error: ${message}`);
        }
        
        function handleVoiceStart() {
            isListening = true;
            log('üé§ Voice recognition started');
            document.getElementById('voice-btn').textContent = 'Stop Voice Recognition';
            document.getElementById('voice-status').textContent = 'Listening... speak now!';
        }
        
        function handleVoiceEnd() {
            isListening = false;
            log('üé§ Voice recognition ended');
            document.getElementById('voice-btn').textContent = 'Start Voice Recognition';
            document.getElementById('voice-status').textContent = 'Click to start voice recognition';
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Debug test page loaded');
            
            setTimeout(() => {
                checkSystem();
                checkManVueFunctions();
            }, 1000);
        });
    </script>
</body>
</html>
